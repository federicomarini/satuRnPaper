---
title: "scalabilityBenchmark"
author: "Jeroen Gilis"
date: "11/11/2020"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
require("knitr")
opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

Load libraries

```{r, message=FALSE}
library(ggplot2)
library(tidyverse)
```

Read all results

```{r}
# read satuRn results
load("./Data/Scalability_runtimes/satuRn_1.RData")
load("./Data/Scalability_runtimes/satuRn_2.RData")

# read limmaDiffsplice results
load("./Data/Scalability_runtimes/limmaDiffsplice_1.RData")
load("./Data/Scalability_runtimes/limmaDiffsplice_2.RData")

# read edgeRDiffsplice results
load("./Data/Scalability_runtimes/edgeRDiffsplice_1.RData")
load("./Data/Scalability_runtimes/edgeRDiffsplice_2.RData")

# read DRIMSeq results
load("./Data/Scalability_runtimes/DRIMSeq_1.RData")
load("./Data/Scalability_runtimes/DRIMSeq_2.RData")

# read DoubleExpSeq results
load("./Data/Scalability_runtimes/DoubleExpSeq_1.RData")
load("./Data/Scalability_runtimes/DoubleExpSeq_2.RData")

# read DEXSeq results
load("./Data/Scalability_runtimes/DEXSeq_2.RData")
load("./Data/Scalability_runtimes/DEXSeq_3.RData")
load("./Data/Scalability_runtimes/DEXSeq_4.RData")

# read BANDITS results
load("./Data/Scalability_runtimes/BANDITS_5.RData")
load("./Data/Scalability_runtimes/BANDITS_6.RData")
```

Concatenate all results

```{r}
Results_all <- c(satuRn_1,satuRn_2,limmaDiffsplice_1,limmaDiffsplice_2,edgeRDiffsplice_1,edgeRDiffsplice_2,DRIMSeq_1,DRIMSeq_2,DoubleExpSeq_1,DoubleExpSeq_2,DEXSeq_2,DEXSeq_3,DEXSeq_4,BANDITS_5,BANDITS_6)
rm(list=setdiff(ls(), "Results_all"))
```

```{r}
full_dataframe <-  as.data.frame(matrix(nrow = length(Results_all), ncol=10))
colnames(full_dataframe) <- c("method", "groupSize", "TXs", "TXs_round", "user", "system", "elapsed", "DTU", "removed", "memory")

full_dataframe$method <- rep(c("satuRn","limmaDiffsplice","edgeRDiffsplice","DRIMSeq","DoubleExpSeq","DEXSeq","BANDITS"),times=c(24,24,24,24,24,16,7)) # add method labels

round_to <- function(x, to = 1000) round(x/to)*to

# get data in dataframe format
for (i in seq_len(nrow(full_dataframe))) {
  full_dataframe$groupSize[i] <- Results_all[[i]]$info$size
  full_dataframe$TXs[i] <- Results_all[[i]]$info$TXs
  full_dataframe$TXs_round[i] <- round_to(full_dataframe$TXs[i])
  full_dataframe$user[i] <- unname(Results_all[[i]]$timing[1])
  full_dataframe$system[i] <- unname(Results_all[[i]]$timing[2])
  full_dataframe$elapsed[i] <- unname(Results_all[[i]]$timing[3])
  full_dataframe$DTU[i] <- ifelse(is.null(Results_all[[i]]$result),NA,Results_all[[i]]$result)
  full_dataframe$removed[i] <- Results_all[[i]]$removed
  full_dataframe$memory[i] <- Results_all[[i]]$memory[4]
}
```

# Visualizations

## Scalability w.r.t. number of cells (1)

Without our method, used to generate Figure 1, panel B from our paper.

```{r}
data_30K <- full_dataframe[which(full_dataframe$TXs_round == 30000),]

png("./Results/Scalability/scale_cells_intro.png",
  width     = 5,
  height    = 5,
  units     = "in",
  res       = 200,
  pointsize = 4)

ggplot(data = data_30K[-which(data_30K$method == "satuRn"),], aes(x=groupSize,y=elapsed/60,color=method)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values=c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2")) +
  theme_bw() +
  ylab("elapsed  time (min)") + 
  xlab("number of cells per group")

dev.off()
```

## Scalability w.r.t. number of transcripts (1)

Without our method, used to generate Figure 1, panel C from our paper.

```{r}
data_16cells <- full_dataframe[which(full_dataframe$groupSize == 16),]

png("./Results/Scalability/scale_transcripts_intro.png",
  width     = 5,
  height    = 5,
  units     = "in",
  res       = 200,
  pointsize = 4)

ggplot(data = data_16cells[-which(data_16cells$method == "satuRn"),], aes(x=TXs,y=elapsed/60,color=method)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values=c("#CC79A7", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2")) +
  theme_bw() +
  ylab("elapsed  time (min)") + 
  xlab("number of transcripts")

dev.off()
```

## Scalability w.r.t. number of cells (2)

Including our method, used to generate Figure 5, panel A from our paper.

```{r}
png("./Results/Scalability/scale_cells_all.png",
  width     = 5,
  height    = 5,
  units     = "in",
  res       = 200,
  pointsize = 4)

ggplot(data = data_30K, aes(x=groupSize,y=elapsed/60,color=method)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values=c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2","black")) +
  theme_bw() +
  ylab("elapsed  time (min)") + 
  xlab("number of cells per group")

dev.off()
```

```{r}
# zoom
png("./Results/Scalability/scale_cells_all_zoom.png",
  width     = 5,
  height    = 5,
  units     = "in",
  res       = 200,
  pointsize = 4)

ggplot(data = data_30K[-which(data_30K$method %in% c("DEXSeq","DRIMSeq")),], aes(x=groupSize,y=elapsed/60,color=method)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values=c("#56B4E9", "#F0E442", "#0072B2","black")) +
  theme_bw() +
  ylab("elapsed  time (min)") + 
  xlab("number of cells per group")

dev.off()
```

## Scalability w.r.t. number of transcripts (2)

Including our method, used to generate Figure 5, panel B from our paper.

```{r}
png("./Results/Scalability/scale_transcripts_all.png",
  width     = 5,
  height    = 5,
  units     = "in",
  res       = 200,
  pointsize = 4)

ggplot(data = data_16cells, aes(x=TXs,y=elapsed/60,color=method)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values=c("#CC79A7", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2","black")) +
  theme_bw() +
  ylab("elapsed  time (min)") + 
  xlab("number of transcripts")

dev.off()
```

```{r}
# zoom
png("./Results/Scalability/scale_transcripts_all_zoom.png",
  width     = 5,
  height    = 5,
  units     = "in",
  res       = 200,
  pointsize = 4)

ggplot(data = data_16cells[-which(data_16cells$method %in% c("BANDITS", "DEXSeq","DRIMSeq")),], aes(x=TXs,y=elapsed/60,color=method)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values=c("#56B4E9", "#F0E442", "#0072B2","black")) +
  theme_bw() +
  ylab("elapsed  time (min)") + 
  xlab("number of transcripts")

dev.off()
```
